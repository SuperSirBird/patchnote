<html>
  <head>
    <title>patchscrapworld - SuperSirBird</title>
    <style>
      body {margin:0px;}
    </style>
  </head>
  <body>
    <canvas id="myCanvas">
      Sorry :/ your browser does not support the canvas element
    </canvas>
    <script>
      
      /* 
      Engine made by SuperSirBird
      */
      
      var c = document.getElementById("myCanvas");
      var ctx=c.getContext("2d");
      c.width  = window.innerWidth;
      c.height = window.innerHeight;
      
      var x;
      var y;
      var z;
      var xrot = 0;
      var yrot = 0;
      var dis;
      var dir;
      
      var objx = [];
      var objy = [];
      var objz = [];
      var facemark = [];
      var faceave = [];
      var orderface = [];
      
      function createcube(x_,y_,z_,r) {
        // xy faces
        objx.push([x_-r,x_+r,x_-r,x_+r],[x_-r,x_+r,x_-r,x_+r]);
        objy.push([y_+r,y_+r,y_-r,y_-r],[y_+r,y_+r,y_-r,y_-r]);
        objz.push([z_-r,z_-r,z_-r,z_-r],[z_+r,z_+r,z_+r,z_+r]);
        facemark.push("f");
        faceave.push(0);
        facemark.push("f");
        faceave.push(0);
        // zy faces
        objz.push([z_-r,z_+r,z_-r,z_+r],[z_-r,z_+r,z_-r,z_+r]);
        objy.push([y_+r,y_+r,y_-r,y_-r],[y_+r,y_+r,y_-r,y_-r]);
        objx.push([x_-r,x_-r,x_-r,x_-r],[x_+r,x_+r,x_+r,x_+r]);
        facemark.push("f");
        faceave.push(0);
        facemark.push("f");
        faceave.push(0);
        // xz faces
        objx.push([x_-r,x_+r,x_-r,x_+r],[x_-r,x_+r,x_-r,x_+r]);
        objz.push([z_+r,z_+r,z_-r,z_-r],[z_+r,z_+r,z_-r,z_-r]);
        objy.push([y_-r,y_-r,y_-r,y_-r],[y_+r,y_+r,y_+r,y_+r]);
        facemark.push("f");
        faceave.push(0);
        facemark.push("f");
        faceave.push(0);
      }
      
      function rotpoint(x_,y_,z_,xr,yr) {
        x = x_;
        y = y_;
        z = z_;
        
        dis = Math.sqrt((x*x) + (z*z));
        dir = Math.atan(x/z); 
        if (z<0) {dir+=180}
        
        x = dis*(Math.sin(dir + xr));
        z = dis*(Math.cos(dir + xr));
        
        dis = Math.sqrt((z*z) + (y*y));
        dir = Math.atan(y/z); 
        if (z<0) {dir+=180}
        
        y = dis*(Math.sin(dir + yr));
        z = dis*(Math.cos(dir + yr));
      }
      
      function calcpoints() {
        for (var i = 0;i<objx.length;i++) {
          var faceave_c = 0;
          for (var c = 0;c<objx[i].length;c++) {
            rotpoint(objx[i][c],objy[i][c],objz[i][c],xrot,yrot)
            objx[i][c] = x;
            objy[i][c] = y;
            objz[i][c] = z;
            faceave_c += z;
          }
          faceave_c = faceave_c/objx[i].length;
          faceave[i] = faceave_c;
        }
      }
      
      function orderfaces() {
        
        for (var i = 0;i<objx.length;i++) {
          facemark[i] = "f";
        }
        
        for (var i = 0;i<objx.length;i++) {
          var highest_z = -999999;
          var highest_i = 0;
          for (var c = 0;c<objx.length;c++) {
            if (facemark[c] === "f") {
              if (faceave[c] > highest_z) {
                highest_z = faceave[c];
                highest_i = c;
              }
            }
          }
          
          orderface.push(highest_i);
          facemark[highest_i] = "t";
          
        }
      }
      
      function perspec(x_,y_,z_) {
        x = (c.width/2) + (200*(x_/(z_+200)));
        y = (c.height/2) - (200*(y_/(z_+200)));
      }
      
      function drawfaces() {
        for (var i = 0;i<orderface.length;i++) {
          ctx.beginPath();
          perspec(objx[orderface[i]][0],objy[orderface[i]][0],objz[orderface[i]][0]);
          ctx.moveTo(x, y);
          perspec(objx[orderface[i]][1],objy[orderface[i]][1],objz[orderface[i]][1]);
          ctx.lineTo(x, y);
          perspec(objx[orderface[i]][3],objy[orderface[i]][3],objz[orderface[i]][3]);
          ctx.lineTo(x, y);
          perspec(objx[orderface[i]][2],objy[orderface[i]][2],objz[orderface[i]][2]);
          ctx.lineTo(x, y);
          ctx.closePath();
          ctx.stroke();
        }
      }
      
      createcube(0,0,0,100);
      calcpoints();
      orderfaces();
      drawfaces();
      
    </script>
  </body>
</html>
